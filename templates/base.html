<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>{% block title %}Quiz Game{% endblock %}</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/Quiz_Logo2.png') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
  <!-- Navigation bar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{{ url_for('dashboard') }}">
        <img src="{{ url_for('static', filename='images/Quiz_Logo2.png') }}" alt="Logo" width="32" height="32"
          class="me-2">
        <span style="font-weight:600; letter-spacing:1px;">Quiz Game</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
        aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-bars"></i> Menu
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
              {% if current_user.is_authenticated %}
                <li><a class="dropdown-item" href="{{ url_for('dashboard') }}"><i class="fas fa-home"></i> Home</a></li>
                <li><a class="dropdown-item" href="{{ url_for('account') }}"><i class="fas fa-user"></i> Account</a></li>
                {% if not current_user.is_admin %}
                  <li><a class="dropdown-item" href="{{ url_for('quiz') }}"><i class="fas fa-question-circle"></i> Quiz</a></li>
                  <li><a class="dropdown-item" href="{{ url_for('my_scores') }}"><i class="fas fa-chart-bar"></i> My Scores</a></li>
                {% endif %}
                {% if current_user.is_admin %}
                  <li><a class="dropdown-item" href="{{ url_for('users') }}"><i class="fas fa-users"></i> Users</a></li>
                  <li><a class="dropdown-item" href="{{ url_for('manage_quiz') }}"><i class="fas fa-cogs"></i> Create Quizzes</a></li>
                  <li><a class="dropdown-item" href="{{ url_for('existing_quizzes') }}"><i class="fas fa-list-alt"></i> Existing Quizzes</a></li>
                  <li><a class="dropdown-item" href="{{ url_for('admin_mark_quizzes') }}"><i class="fas fa-marker"></i> Mark Quizzes</a></li>
                {% endif %}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
              {% else %}
                <li><a class="dropdown-item" href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> Login</a></li>
                <li><a class="dropdown-item" href="{{ url_for('register') }}"><i class="fas fa-user-plus"></i> Register</a></li>
              {% endif %}
            </ul>
          </li>
          <li class="nav-item">
            <button class="btn-toggle-mode" id="toggle-mode-btn" title="Toggle dark/light mode">
              <span id="mode-text">Dark Mode</span>
              <i class="fas fa-moon" id="mode-icon"></i>
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container main-content">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Detect system preference and apply on first load
    function getPreferredMode() {
      if (localStorage.getItem('theme')) {
        return localStorage.getItem('theme');
      }
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    function applyMode(mode) {
      document.body.classList.remove('light-mode', 'dark-mode');
      document.body.classList.add(mode + '-mode');
      // Change icon and text
      const icon = document.getElementById('mode-icon');
      const text = document.getElementById('mode-text');
      if (mode === 'dark') {
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
        text.textContent = 'Light Mode';
      } else {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
        text.textContent = 'Dark Mode';
      }
      // Force update of all form controls (for pre-filled values)
      document.querySelectorAll('.form-control, textarea, select').forEach(function(el) {
        el.style.background = getComputedStyle(document.body).getPropertyValue('--input-bg');
        el.style.color = getComputedStyle(document.body).getPropertyValue('--input-text');
        el.style.borderColor = getComputedStyle(document.body).getPropertyValue('--input-border');
      });
      // Force update of all cards and tables
      document.querySelectorAll('.card, .table, .table-bordered, .table-striped, .table-hover, .table th, .table td').forEach(function(el) {
        el.style.background = getComputedStyle(document.body).getPropertyValue('--card-bg');
        el.style.color = getComputedStyle(document.body).getPropertyValue('--main-text');
      });
    }

    // On page load
    document.addEventListener('DOMContentLoaded', function () {
      const mode = getPreferredMode();
      applyMode(mode);

      document.getElementById('toggle-mode-btn').addEventListener('click', function () {
        const current = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
        const next = current === 'dark' ? 'light' : 'dark';
        applyMode(next);
        localStorage.setItem('theme', next);
      });
    });
  </script>
</body>

</html>